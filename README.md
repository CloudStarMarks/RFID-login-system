# RFID LOGIN SYSTEM

## 目的

1. 使電腦在未登入的情況下無法正常使用
1. 監測客戶端所在電腦的使用情況:
   1. 由誰使用
   2. 登入時間
   3. 離開時間

## 目標

- 使此程式無法被正常手段被一般使用者關閉

- 客戶端登入手段:

  1. 卡片
  1. 使用者帳密
  1. 開發人員通道 _(輸入 token 登入)_

- 客戶端在以下情況向伺服器回報:

  1. 登入:
     1. 登入成功
     2. 登入失敗 **(未實作)**
  2. 關機

- 伺服器如何處理客戶端的回報:
  1. 登入成功，紀錄:
     1. 使用紀錄辨識碼
     1. 電腦辨識碼 _(由 ServerHandler 附加)_
     1. 使用者辨識碼
     1. 登入時間
  2. 程式關閉，紀錄:
     1. 使用紀錄辨識碼
     1. 離開時間

## 使用注意事項

${\color{red}目前該專案為測試版本}$<br/>
${\color{red}如要執行專案強烈建議在虛擬機上執行，如在實機上運行有可能造成難以回復的錯誤}$<br/><br/>
如果想要真正執行上述的功能，必須手動設定以下事項:

1. 將 BGService.exe 註冊至服務(Windos service)，並將其調至自動開啟
2. 使用工作排程器將 LoginUI.exe 註冊至工作排程表
3. 在其他在相同網域內的電腦或伺服器上運行 server 資料夾中的程式

${\color{red}在執行上述動作時請勿將程式與其資料夾中的附加檔案分離，否則有極大可能無法正常運行}$

## 如何實現

### 資料庫

- 靜態資料庫:
  - 學號及密碼:
    - 使用者辨識碼 **(PK)**
    - 密碼
  - 學生證內碼:
    - 卡片內碼 **(PK)**
    - 使用者辨識碼
- 動態資料庫:
  - 使用紀錄:
    - 使用紀錄辨識碼 **(PK)**
    - 電腦辨識碼
    - 使用者辨識碼
    - 登入時間
    - 登出時間
  - 學生與使用紀錄:
    - 使用者辨識碼 **(PK)**
    - 使用紀錄辨識碼 _(最後)_
- 將靜態與動態資料庫分離

### 客戶端

- 在 Windows Service 運行

- 記錄錯誤檔 (公用文件/LoginSystem/)

- 登入網址:

  - 可通過 settings.json 改變
  - 或許可以通過從伺服器下載設定 **(未實現)**

- 在登入成功後:

  - 主視窗關閉
  - 關機回傳: 使用紀錄辨識碼

- 登入資料:

  1. 卡片內碼
  1. 使用者帳密
  1. 開發人員 token

- 介面:
  - 無控制項方塊 (最上方包含最小化、最大化、關閉等按鈕的方塊) **(於發行階段實施)**
  - 視窗無邊界最大化
  - 分頁:
    1. RFID:
       - 讀卡登入
       - 提醒文字位於中央
    1. user login:
       - 輸入帳密登入
       - 提醒文字位於下方 (初始為隱藏狀態)
    1. dev pass:
       - 輸入開發人員 token 登入
       - 提醒文字位於下方 (初始為隱藏狀態)
- 讀卡:
  - 使用讀卡機原廠程式
    - 該程式讀取卡片內碼時 **使用鍵盤輸入**
    - 須建立副執行緒
      - 防止讀取輸入時，干擾主執行緒運作
      - 開關該程式
        - 開啟: 位於 RFID 分頁時
        - 關閉:
          - 離開 RFID 分頁時
          - 關閉程式時
  - 因為讀卡機，使用 **鍵盤讀取** 方式 _(有可能會被原生鍵盤輸入干擾)_
- 螢幕控制:
  - 無控制項方塊 **(於發行階段實施)**
  - 防止使用者關閉 **(於發行階段實施)**
  - 視窗永遠置頂
  - 視窗無邊界最大化

### 伺服器

- URI: _使用者自訂_
- 位址:
  - /clientSubmit
    - /innerCode_login: 供卡片內碼登入使用
    - /account_login: 供帳密登入使用
    - /devPass: 供開發人員登入使用
  - /closeReport: 供程式關閉回報使用
- 回應:
  - 伺服器連接錯誤: 無回應
  - 伺服器內部錯誤: HTML
  - 登入成功:
    - 一般: 0、使用紀錄辨識碼
    - token: 5
  - 登入失敗:
    - 帳號錯誤: 1
    - 密碼錯誤: 2
    - 卡片內碼錯誤: 3
    - 開發人員 token 錯誤: 4
    - 使用者已登入其他設備: 6
